<!DOCTYPE html>
<html lang="vi">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ki·ªÉm Tra To√°n 10</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.0/dist/css/bootstrap.min.css" rel="stylesheet">
    <script>
    MathJax = {
        tex: { 
            inlineMath: [['$', '$'], ['\\(', '\\)']],
            displayMath: [['$$', '$$'], ['\\[', '\\]']],
            processEscapes: true
        },
        svg: { fontCache: 'global' }
    };
    </script>
    <script id="MathJax-script" async src="https://cdn.jsdelivr.net/npm/mathjax@3/es5/tex-mml-chtml.js"></script>
    <style>
        body { background: #f0f2f5; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; }
        .quiz-card { background: white; border-radius: 12px; padding: 25px; margin-bottom: 25px; box-shadow: 0 4px 6px rgba(0,0,0,0.05); }
        .q-header { border-left: 5px solid #0d6efd; padding-left: 15px; margin-bottom: 20px; }
        .q-title { font-weight: 700; color: #2c3e50; font-size: 1.1rem; }
        .btn-option { width: 100%; text-align: left; margin: 5px 0; padding: 12px; border: 1px solid #dee2e6; border-radius: 8px; transition: 0.2s; background: white; cursor: pointer; }
        .btn-option:hover { background: #f8f9fa; border-color: #adb5bd; }
        .btn-option.selected { background: #e7f1ff; border-color: #0d6efd; color: #0d6efd; font-weight: bold; }
        .solution-area { display: none; margin-top: 15px; padding: 20px; background: #e8f5e9; border-radius: 8px; border: 1px dashed #198754; }
        img { max-width: 100%; height: auto; border-radius: 5px; margin: 10px 0; display: block; }
        .error-msg { color: red; font-weight: bold; padding: 20px; text-align: center; }
    </style>
</head>
<body>
<div class="container py-5" style="max-width: 800px;">
    <h1 class="text-center mb-5 fw-bold text-primary">ƒê·ªÄ KI·ªÇM TRA TO√ÅN</h1>
    <div id="loading" class="text-center text-muted">ƒêang x·ª≠ l√Ω d·ªØ li·ªáu...</div>
    <div id="quiz-container"></div>
</div>

<script>
    const FILE_MD = 'ketqua.md';

    // --- B·ªò L·ªåC QUAN TR·ªåNG: S·ª¨A L·ªñI PANDOC ---
    function superClean(text) {
        if (!text) return "";
        return text
            // 1. S·ª¨A L·ªñI TO√ÅN (Quan tr·ªçng nh·∫•t)
            // ƒê·ªïi \$ th√†nh $ (ƒë·ªÉ MathJax hi·ªÉu)
            .replace(/\\\$/g, '$')
            // ƒê·ªïi \\ th√†nh \ (ƒë·ªÉ c√°c l·ªánh nh∆∞ \left, \frac ho·∫°t ƒë·ªông)
            .replace(/\\\\/g, '\\') 
            // ƒê·ªïi \[ v√† \] th√†nh $$ ƒë·ªÉ hi·ªÉn th·ªã c√¥ng th·ª©c cƒÉn gi·ªØa
            .replace(/\\\[/g, '$$').replace(/\\\]/g, '$$')

            // 2. S·ª¨A L·ªñI ƒê√ÅP √ÅN D√çNH CH√ôM
            // T√¨m b·∫•t k·ª≥ ch·ªó n√†o c√≥ d·∫°ng " A." ho·∫∑c "**A.**" m√† ƒëang n·∫±m gi·ªØa d√≤ng -> ƒê·∫©y xu·ªëng d√≤ng
            .replace(/(\s+)(\*\*|__)?([A-D])(\.|:|\))(?:\*\*|__)?/g, '\n$3.')

            // 3. D·ªåN R√ÅC KH√ÅC
            .replace(/^[\s\t]*[>|]\s*/gm, '') // X√≥a d·∫•u > th·ª´a
            .replace(/^\s*\+[-]+\+\s*$/gm, '') // X√≥a d√≤ng k·∫ª b·∫£ng
            .replace(/!\[(.*?)\]\((.*?)\)/g, '<img src="$2" alt="$1">') // ·∫¢nh
            .replace(/\*\*(.*?)\*\*/g, '<b>$1</b>') // In ƒë·∫≠m
            .replace(/\*(.*?)\*/g, '<em>$1</em>'); // In nghi√™ng
    }

    async function loadQuiz() {
        const container = document.getElementById('quiz-container');
        const loading = document.getElementById('loading');
        
        try {
            const res = await fetch(FILE_MD);
            if (!res.ok) throw new Error(`Kh√¥ng ƒë·ªçc ƒë∆∞·ª£c file ${FILE_MD}`);
            let text = await res.text();
            
            // B∆∞·ªõc 1: Ch·∫°y b·ªô l·ªçc s·ª≠a l·ªói
            text = superClean(text);

            // B∆∞·ªõc 2: T√°ch c√¢u h·ªèi
            // Regex t√¨m: ƒê·∫ßu d√≤ng -> (c√≥ th·ªÉ c√≥ C√¢u/B√†i) -> S·ªë -> D·∫•u ch·∫•m/hai ch·∫•m
            const questionRegex = /(?:^|\n)\s*(?:(?:\*\*|__)?(?:C√¢u|B√†i)\s+)?(\d+)[\.:]\s+/i;

            const rawParts = text.split(questionRegex);
            const questions = [];

            for (let i = 1; i < rawParts.length; i += 2) {
                const qNum = rawParts[i]; 
                const qBody = rawParts[i+1];
                if(qBody) {
                    questions.push({ num: qNum, text: qBody });
                }
            }

            if (questions.length === 0) {
                throw new Error("Kh√¥ng t√¨m th·∫•y c√¢u h·ªèi. H√£y ki·ªÉm tra l·∫°i file MD.");
            }

            loading.style.display = 'none';

            // B∆∞·ªõc 3: Hi·ªÉn th·ªã
            questions.forEach((q, index) => {
                const lines = q.text.trim().split('\n');
                let content = "";
                let options = [];
                let solution = "";
                let isSolution = false;

                lines.forEach(line => {
                    line = line.trim();
                    if (!line) return;

                    // Nh·∫≠n di·ªán L·ªùi gi·∫£i
                    if (line.match(/^(?:L·ªùi gi·∫£i|H∆∞·ªõng d·∫´n)/i)) {
                        isSolution = true;
                        return; 
                    }

                    // Nh·∫≠n di·ªán ƒê√°p √°n A. B. C. D. (ƒê√£ ƒë∆∞·ª£c b·ªô l·ªçc ƒë·∫©y xu·ªëng ƒë·∫ßu d√≤ng)
                    const optMatch = line.match(/^\s*(?:\*\*)?([A-D])(?:\.|:|\))(?:\*\*)?\s*(.*)/);
                    
                    if (!isSolution && optMatch) {
                        options.push({ label: optMatch[1], val: optMatch[2] });
                    } 
                    else {
                        if (isSolution) solution += line + "<br>";
                        else content += line + " "; // N·ªëi c√°c d√≤ng c√¢u h·ªèi l·∫°i cho li·ªÅn m·∫°ch
                    }
                });

                // N·∫øu kh√¥ng t√¨m th·∫•y ƒë√°p √°n (v·∫´n b·ªã l·ªói), th·ª≠ hi·ªÉn th·ªã c·∫£nh b√°o
                let optionsHtml = '';
                if (options.length > 0) {
                    optionsHtml = options.map(opt => 
                        `<div class="col-md-6"><button class="btn-option" onclick="showSol(this, ${index})"><strong>${opt.label}.</strong> ${opt.val}</button></div>`
                    ).join('');
                } else {
                    optionsHtml = '<div class="col-12 text-muted fst-italic">Kh√¥ng t√°ch ƒë∆∞·ª£c ƒë√°p √°n (Ki·ªÉm tra l·∫°i format).</div>';
                }

                const card = document.createElement('div');
                card.className = 'quiz-card';
                card.innerHTML = `
                    <div class="q-header">
                        <div class="q-title">C√¢u ${q.num}</div>
                        <div class="mt-2">${content}</div>
                    </div>
                    <div class="row">${optionsHtml}</div>
                    <div id="sol-${index}" class="solution-area">
                        <strong>üí° H∆∞·ªõng d·∫´n gi·∫£i:</strong><br>${solution || 'Kh√¥ng c√≥ l·ªùi gi·∫£i chi ti·∫øt.'}
                    </div>
                `;
                container.appendChild(card);
            });
            
            // V·∫Ω l·∫°i c√¥ng th·ª©c to√°n
            MathJax.typesetPromise(); 

        } catch (err) {
            loading.innerHTML = `<div class="error-msg">${err.message}</div>`;
        }
    }
    
    function showSol(btn, id) {
        let parent = btn.closest('.row');
        if(parent) {
            parent.querySelectorAll('.btn-option').forEach(b => b.classList.remove('selected'));
        }
        btn.classList.add('selected');
        document.getElementById(`sol-${id}`).style.display = 'block';
    }

    loadQuiz();
</script>
</body>
</html>
